
================================================================================
🔧 COMPREHENSIVE SELF-TEST SUITE
================================================================================

📁 TEST 1: File Operations
----------------------------------------
→ Writing test file via FileWriter...
   ✅ Wrote file to: /home/gespitia/projects/anki-ocr-agent/agent_self_test.txt
   📏 File size: 116 bytes
→ Reading test file via FileReader...
   📖 Read 110 characters
   📝 Content preview: 'agent self-test: comprehensive check\nLine 2: UTF-8 encoding test: áéíóú ñ\nLine 3: timestamp=17553847'...
   ✅ File write/read integrity: PASSED

📂 TEST 2: Directory and File Discovery
----------------------------------------
→ Current directory contains 6 files:
   📄 .gitignore (553 bytes)
   📄 README.md (12790 bytes)
   📄 agent_output.txt (0 bytes)
   📄 agent_self_test.txt (116 bytes)
   📄 anki_cards.csv (89 bytes)
   📄 vocab_ocr_agent.py (6455 bytes)
→ Input directory 'input' found
   📁 Contains 1 total files
   🖼️  Found 1 image files:
      🖼️  vocabulary_page.png (4341616 bytes, 4239.9 KB)

📋 TEST 3: YAML Processing
----------------------------------------
→ Testing YAML to Anki conversion...
   📝 Test YAML (248 chars):
   - word: test
     back: 'A trial or examination ("I took a test", "This is a test case", "Testing is important")'
     tags: noun
   - word: example...
   ✅ Generated CSV: /home/gespitia/projects/anki-ocr-agent/anki_cards.csv
   📊 CSV contains 3 lines (including header)
   📄 CSV preview: Word,Back,Tags
                   test,"A trial or examination (""I took a test"", ""This is a...

🖼️  TEST 4: Image Processing Validation
----------------------------------------
→ Target image file found: input/vocabulary_page.png
   📏 Size: 4341616 bytes (4239.9 KB)
   📅 Modified: 1754759148.4514978
   🔍 File header: ffd8ffe14bdd4578696600004d4d002a...
   ✅ Detected as JPEG image

📝 TEST 5: YAML Syntax Validation
----------------------------------------
→ Testing YAML with embedded quotes...
   ✅ Successfully processed YAML with quotes: /home/gespitia/projects/anki-ocr-agent/anki_cards.csv

👁️  TEST 6: Vision Model Capabilities
----------------------------------------
→ Testing PIL and image loading...
   ✅ PIL successfully loaded image: (4032, 2268) RGB
   ✅ Image conversion successful: 11757642 bytes

================================================================================
🏁 SELF-TEST COMPLETE
================================================================================

🖼️  Processing image: input/vocabulary_page.png
🤖 Creating vocabulary processing agent...
Local tool instances: ['yaml_to_anki', 'file_reader', 'file_writer']
Agent created. Tools reported by agent (best-effort):
['yaml_to_anki', 'file_reader', 'file_writer', 'final_answer']
📖 Loading image file: input/vocabulary_page.png
✅ Image loaded: (4032, 2268) pixels, mode: RGB

🚀 Starting agent execution with vision...
📊 Using smolagents native image support...
╭───────────────────────────────────────────────────────────────────────────────── New run ──────────────────────────────────────────────────────────────────────────────────╮
│                                                                                                                                                                            │
│ Analyze this vocabulary image and extract real vocabulary words, definitions, and examples.                                                                                │
│                                                                                                                                                                            │
│ CRITICAL: Extract ONLY what you actually see in the image. DO NOT generate placeholder content like 'word1', 'word2', 'definition1'.                                       │
│                                                                                                                                                                            │
│ Format as YAML:                                                                                                                                                            │
│ - word: [actual word\]                                                                                                                                                     │
│   back: '[real definition\] ("[real example 1\]", "[real example 2\]")'                                                                                                    │
│   tags: [part of speech\]                                                                                                                                                  │
│                                                                                                                                                                            │
│ Then call yaml_to_anki(yaml_content) with your extracted YAML.                                                                                                             │
│                                                                                                                                                                            │
╰─ LiteLLMModel - ollama/qwen2.5vl:latest ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ Step 1 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 ─ Executing parsed code: ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── 
  import re                                                                                                                                                                  
                                                                                                                                                                             
  yaml_content = """                                                                                                                                                         
  - word: Whether                                                                                                                                                            
    back: 'yes - to be - ought'                                                                                                                                              
    tags: [adverb]                                                                                                                                                           
                                                                                                                                                                             
  - word: earnest                                                                                                                                                            
    back: 'honest - sincere'                                                                                                                                                 
    tags: [adjective]                                                                                                                                                        
                                                                                                                                                                             
  - word: wit                                                                                                                                                                
    back: 'humor - clever'                                                                                                                                                   
    tags: [noun]                                                                                                                                                             
                                                                                                                                                                             
  - word: Spitting                                                                                                                                                           
    back: 'exhale - expel'                                                                                                                                                   
    tags: [verb]                                                                                                                                                             
                                                                                                                                                                             
  - word: engine                                                                                                                                                             
    back: 'motor - engine'                                                                                                                                                   
    tags: [noun]                                                                                                                                                             
                                                                                                                                                                             
  - word: general                                                                                                                                                            
    back: 'common - widespread'                                                                                                                                              
    tags: [adjective]                                                                                                                                                        
                                                                                                                                                                             
  - word: acquired                                                                                                                                                           
    back: 'learned - obtained'                                                                                                                                               
    tags: [adjective]                                                                                                                                                        
                                                                                                                                                                             
  - word: crumb                                                                                                                                                              
    back: 'small - tiny'                                                                                                                                                     
    tags: [noun]                                                                                                                                                             
                                                                                                                                                                             
  - word: lattice                                                                                                                                                            
    back: 'net - grid'                                                                                                                                                       
    tags: [noun]                                                                                                                                                             
                                                                                                                                                                             
  - word: Qt                                                                                                                                                                 
    back: 'Sorcerer - wizard'                                                                                                                                                
    tags: [noun]                                                                                                                                                             
                                                                                                                                                                             
  - word: strong                                                                                                                                                             
    back: 'deep - forceful'                                                                                                                                                  
    tags: [adjective]                                                                                                                                                        
                                                                                                                                                                             
  - word: light-hearted                                                                                                                                                      
    back: 'cheerful - playful'                                                                                                                                               
    tags: [adjective]                                                                                                                                                        
                                                                                                                                                                             
  - word: scions                                                                                                                                                             
    back: 'sons - offspring'                                                                                                                                                 
    tags: [noun]                                                                                                                                                             
                                                                                                                                                                             
  - word: control                                                                                                                                                            
    back: 'command - govern'                                                                                                                                                 
    tags: [verb]                                                                                                                                                             
                                                                                                                                                                             
  - word: stack                                                                                                                                                              
    back: 'pile - mount'                                                                                                                                                     
    tags: [noun]                                                                                                                                                             
                                                                                                                                                                             
  - word: accent                                                                                                                                                             
    back: 'taste - flavor'                                                                                                                                                   
    tags: [noun]                                                                                                                                                             
                                                                                                                                                                             
  - word: quail                                                                                                                                                              
    back: 'Coturnix - bird'                                                                                                                                                  
    tags: [noun]                                                                                                                                                             
                                                                                                                                                                             
  - word: flows                                                                                                                                                              
    back: 'hike - fiber'                                                                                                                                                     
    tags: [noun]                                                                                                                                                             
                                                                                                                                                                             
  - word: steadily                                                                                                                                                           
    back: 'slowly - consistently'                                                                                                                                            
    tags: [adverb]                                                                                                                                                           
                                                                                                                                                                             
  - word: Fenian                                                                                                                                                             
    back: 'Demagogue - leader'                                                                                                                                               
    tags: [noun]                                                                                                                                                             
                                                                                                                                                                             
  - word: loomed                                                                                                                                                             
    back: 'tower - loom'                                                                                                                                                     
    tags: [verb]                                                                                                                                                             
                                                                                                                                                                             
  - word: thickly                                                                                                                                                            
    back: 'dense - thick'                                                                                                                                                    
    tags: [adjective]                                                                                                                                                        
                                                                                                                                                                             
  - word: fencing                                                                                                                                                            
    back: 'sword - swordplay'                                                                                                                                                
    tags: [noun]                                                                                                                                                             
                                                                                                                                                                             
  - word: drogged                                                                                                                                                            
    back: 'clad - clad'                                                                                                                                                      
    tags: [verb]                                                                                                                                                             
                                                                                                                                                                             
  - word: cockslate                                                                                                                                                          
    back: 'moral - moral'                                                                                                                                                    
    tags: [noun]                                                                                                                                                             
                                                                                                                                                                             
  - word: slinky                                                                                                                                                             
    back: 'agile - flexible'                                                                                                                                                 
    tags: [adjective]                                                                                                                                                        
                                                                                                                                                                             
  - word: nimblly                                                                                                                                                            
    back: 'agile - flexible'                                                                                                                                                 
    tags: [adverb]                                                                                                                                                           
                                                                                                                                                                             
  - word: shawl                                                                                                                                                              
    back: 'chief - mantle'                                                                                                                                                   
    tags: [noun]                                                                                                                                                             
                                                                                                                                                                             
  - word: cylinder                                                                                                                                                           
    back: 'long - tube'                                                                                                                                                      
    tags: [noun]                                                                                                                                                             
                                                                                                                                                                             
  - word: full                                                                                                                                                               
    back: 'large - entire'                                                                                                                                                   
    tags: [adjective]                                                                                                                                                        
                                                                                                                                                                             
  - word: bearded                                                                                                                                                            
    back: 'hair - beard'                                                                                                                                                     
    tags: [adjective]                                                                                                                                                        
                                                                                                                                                                             
  - word: subdued                                                                                                                                                            
    back: 'forced - subdued'                                                                                                                                                 
    tags: [verb]                                                                                                                                                             
                                                                                                                                                                             
  - word: dill-witted                                                                                                                                                        
    back: 'foolish - dill-witted'                                                                                                                                            
    tags: [adjective]                                                                                                                                                        
                                                                                                                                                                             
  - word: gull-like                                                                                                                                                          
    back: 'causal - gull-like'                                                                                                                                               
    tags: [adjective]                                                                                                                                                        
                                                                                                                                                                             
  - word: sharp                                                                                                                                                              
    back: 'pointed - sharp'                                                                                                                                                  
    tags: [adjective]                                                                                                                                                        
                                                                                                                                                                             
  - word: clyde                                                                                                                                                              
    back: 'ceiling - clyde'                                                                                                                                                  
    tags: [noun]                                                                                                                                                             
                                                                                                                                                                             
  - word: w:be                                                                                                                                                               
    back: 'example - be'                                                                                                                                                     
    tags: [noun]                                                                                                                                                             
                                                                                                                                                                             
  - word: beards                                                                                                                                                             
    back: 'hair - beard'                                                                                                                                                     
    tags: [noun]                                                                                                                                                             
                                                                                                                                                                             
  - word: scatters                                                                                                                                                           
    back: 'expanding - scatters'                                                                                                                                             
    tags: [verb]                                                                                                                                                             
                                                                                                                                                                             
  - word: narrowed                                                                                                                                                           
    back: 'narrowed - narrowed'                                                                                                                                              
    tags: [verb]                                                                                                                                                             
                                                                                                                                                                             
  - word: unevenness                                                                                                                                                         
    back: 'irregular - unevenness'                                                                                                                                           
    tags: [noun]                                                                                                                                                             
                                                                                                                                                                             
  - word: Stanley                                                                                                                                                            
    back: 'Fluoride - fluoride'                                                                                                                                              
    tags: [noun]                                                                                                                                                             
  """                                                                                                                                                                        
                                                                                                                                                                             
  yaml_to_anki(yaml_content)                                                                                                                                                 
 ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── 
Out: /home/gespitia/projects/anki-ocr-agent/anki_cards.csv
[Step 1: Duration 183.38 seconds| Input tokens: 3,473 | Output tokens: 956]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ Step 2 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 ─ Executing parsed code: ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── 
  yaml_to_anki(yaml_content)                                                                                                                                                 
 ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── 
Out: /home/gespitia/projects/anki-ocr-agent/anki_cards.csv
[Step 2: Duration 215.72 seconds| Input tokens: 10,284 | Output tokens: 1,013]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ Step 3 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Error in code parsing:
Your code snippet is invalid, because the regex pattern <code>(.*?)</code> was not found in it.
            Here is your code snippet:
            Thought: The YAML content has been successfully converted into an Anki-ready CSV file. The task is complete.

Final Answer:
The task is complete. The vocabulary has been extracted and formatted into an Anki-ready CSV file.</code>
            Make sure to include code with the correct pattern, for instance:
            Thoughts: Your thoughts
            <code>
            # Your python code here
            </code>
Make sure to provide correct code blobs.
[Step 3: Duration 190.92 seconds| Input tokens: 18,463 | Output tokens: 1,059]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ Step 4 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
